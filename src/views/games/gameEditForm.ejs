<!DOCTYPE html>
<html lang="en">
  <%- include('../partials/head') %>
  <body>
    <%- include('../partials/nav') %>

    <form action="/games/<%= game.game_id %>/edit" method="post">
      <p>Edit game:</p>
      
          <% if (typeof errors !== 'undefined' && errors.length > 0) { %>
      <div class="errors">
        <% errors.forEach(error => { %>
          <p style="color: red;"><%= error.msg %></p>
        <% }); %>
      </div>
    <% } %>

      <p>
        <label for="title">Title:</label>
        <input
          type="text"
          id="title"
          name="title"
          value="<%= typeof title !== 'undefined' ? title : game.title %>"
          required
        />
      </p>

      <p>
        <label for="released">Released:</label>
        <input
          type="number"
          id="released"
          name="released"
          value="<%= typeof released !== 'undefined' ? released : game.released %>"
          required
        />
      </p>

      <p>
        <label for="genre">Genre:</label>
        <select name="genre" id="genre">
          <option value="" disabled <%= (typeof genre !== 'undefined' ? !genre : !game.genre) ? 'selected' : '' %>>
            Select genre
          </option>
          <% genres.forEach(genreItem => { %>
            <option
              value="<%= genreItem.genre_id %>"
              <%= (typeof genre !== 'undefined' ? genre == genreItem.genre_id : game.genre === genreItem.genre_id) ? 'selected' : '' %>
            >
              <%= genreItem.name %>
            </option>
          <% }); %>
        </select>
      </p>

      <fieldset>
        <legend>Platform:</legend>
        <% platforms.forEach(platform => { %>
          <input
            type="checkbox"
            name="platforms"
            value="<%= platform.platform_id %>"
            id="platform-<%= platform.platform_id %>"
            <%= (typeof selectedPlatforms !== 'undefined' ? (Array.isArray(selectedPlatforms) ? selectedPlatforms.includes(platform.platform_id.toString()) : selectedPlatforms == platform.platform_id) : (game.platforms && game.platforms.includes(platform.name))) ? 'checked' : '' %>
          >
          <label for="platform-<%= platform.platform_id %>">
            <%= platform.name %>
          </label>
        <% }); %>
      </fieldset>

      <button type="submit">Update</button>
    </form>
    
    <br />
    <%- include('../partials/goBack') %>
  </body>
</html>